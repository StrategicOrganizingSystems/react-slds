'use strict';exports.__esModule=true;exports.Calendar=undefined;var _react=require('react');var _react2=_interopRequireDefault(_react);var _propTypes=require('prop-types');var _propTypes2=_interopRequireDefault(_propTypes);var _get_days_in_month=require('date-fns/get_days_in_month');var _get_days_in_month2=_interopRequireDefault(_get_days_in_month);var _get_day=require('date-fns/get_day');var _get_day2=_interopRequireDefault(_get_day);var _sub_months=require('date-fns/sub_months');var _sub_months2=_interopRequireDefault(_sub_months);var _add_months=require('date-fns/add_months');var _add_months2=_interopRequireDefault(_add_months);var _last_day_of_month=require('date-fns/last_day_of_month');var _last_day_of_month2=_interopRequireDefault(_last_day_of_month);var _is_same_month=require('date-fns/is_same_month');var _is_same_month2=_interopRequireDefault(_is_same_month);var _format=require('date-fns/format');var _format2=_interopRequireDefault(_format);var _is_today=require('date-fns/is_today');var _is_today2=_interopRequireDefault(_is_today);var _is_same_day=require('date-fns/is_same_day');var _is_same_day2=_interopRequireDefault(_is_same_day);var _lodash=require('lodash');var _ButtonIcon=require('./ButtonIcon');var _ButtonIcon2=_interopRequireDefault(_ButtonIcon);var _utils=require('../utils');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}// slds component
var generateCalendarDates=function generateCalendarDates(date){var daysOfCalendarMonth=[];var month=date.getMonth();var year=date.getFullYear();var daysOfCurrentMonth=(0,_get_days_in_month2.default)(date);var firstDayOfMonth=new Date(year,month,1);var dayOfFirstDay=(0,_get_day2.default)(firstDayOfMonth);// previous month
var prevDate=(0,_sub_months2.default)(date,1);var datesOfPrevMonth=[];if(dayOfFirstDay){var prevMonth=prevDate.getMonth();var prevYear=prevDate.getFullYear();var daysPrevMonth=(0,_get_days_in_month2.default)(new Date(prevYear,prevMonth));var calendarStartDay=daysPrevMonth-dayOfFirstDay+1;datesOfPrevMonth=(0,_lodash.range)(calendarStartDay,daysPrevMonth+1).map(function(day){return new Date(prevYear,prevMonth,day)})}// next month
var datesOfNextMonth=[];var dayOfLastDay=(0,_get_day2.default)((0,_last_day_of_month2.default)(date));var nextDate=(0,_add_months2.default)(date,1);if(dayOfLastDay<6){var nextMonth=nextDate.getMonth();var nextYear=nextDate.getFullYear();datesOfNextMonth=(0,_lodash.range)(1,6-dayOfLastDay+1).map(function(day){return new Date(nextYear,nextMonth,day)})}var datesOfCurrrentMonth=(0,_lodash.range)(1,daysOfCurrentMonth+1).map(function(day){return new Date(year,month,day)});daysOfCalendarMonth=[].concat(datesOfPrevMonth,datesOfCurrrentMonth,datesOfNextMonth);return(0,_lodash.chunk)(daysOfCalendarMonth,7)};var Calendar=exports.Calendar=function Calendar(props){return _react2.default.createElement('table',{'aria-labelledby':'month','aria-multiselectable':'true',className:'slds-datepicker__month',role:'grid'},_react2.default.createElement('thead',null,_react2.default.createElement('tr',{id:'weekdays'},_react2.default.createElement('th',{id:'Sunday',scope:'col'},_react2.default.createElement('abbr',{title:'Sunday'},'Sun')),_react2.default.createElement('th',{id:'Monday',scope:'col'},_react2.default.createElement('abbr',{title:'Monday'},'Mon')),_react2.default.createElement('th',{id:'Tuesday',scope:'col'},_react2.default.createElement('abbr',{title:'Tuesday'},'Tue')),_react2.default.createElement('th',{id:'Wednesday',scope:'col'},_react2.default.createElement('abbr',{title:'Wednesday'},'Wed')),_react2.default.createElement('th',{id:'Thursday',scope:'col'},_react2.default.createElement('abbr',{title:'Thursday'},'Thu')),_react2.default.createElement('th',{id:'Friday',scope:'col'},_react2.default.createElement('abbr',{title:'Friday'},'Fri')),_react2.default.createElement('th',{id:'Saturday',scope:'col'},_react2.default.createElement('abbr',{title:'Saturday'},'Sat')))),_react2.default.createElement('tbody',null,generateCalendarDates(props.date).map(function(week,i){return _react2.default.createElement('tr',{key:i},week.map(function(dayDate){var isDayInSameMonth=(0,_is_same_month2.default)(props.date,dayDate);var className=(0,_utils.createClassName)(!isDayInSameMonth?'slds-disabled-text':null,(0,_is_today2.default)(dayDate)?'slds-is-today':null,(0,_utils.isDefined)(props.selected)&&(0,_is_same_day2.default)(props.selected,dayDate)?'slds-is-selected':null);return _react2.default.createElement('td',{key:dayDate,'aria-disabled':!isDayInSameMonth.toString(),'aria-selected':!isDayInSameMonth.toString(),'aria-current':(0,_is_today2.default)(dayDate)?'date':null,className:className,role:'gridcell'},_react2.default.createElement('span',{className:'slds-day',onClick:function onClick(){return props.onClickDay(dayDate)}},dayDate.getDate()))}))})))};Calendar.defaultProps={date:new Date};var uid=(0,_lodash.uniqueId)();var datepickerId='datepicker-'+uid;var selectId='datepicker-select-'+selectId;var Datepicker=function(_PureComponent){_inherits(Datepicker,_PureComponent);function Datepicker(){var _temp,_this,_ret;_classCallCheck(this,Datepicker);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,_PureComponent.call.apply(_PureComponent,[this].concat(args))),_this),_this.state={date:_this.props.date||new Date,selectedDate:null,open:false},_this.onClickToday=function(e){var date=new Date;_this.setState({date:date});if(_this.props.onClickToday){_this.props.onClickToday(e,date)}},_this.onClickPrevMonth=function(e){var date=(0,_sub_months2.default)(_this.state.date,1);_this.setState({date:date});if(_this.props.onClickPrevMonth){_this.props.onClickPrevMonth(e,date)}},_this.onClickNextMonth=function(e){var date=(0,_add_months2.default)(_this.state.date,1);_this.setState({date:date});if(_this.props.onClickNextMonth){_this.props.onClickNextMonth(e,date)}},_this.onClickDay=function(date){if(_this.props.onClickDay){_this.props.onClickDay(date)}_this.setState({selectedDate:date})},_this.onChangeYear=function(e){var newDate=_this.state.selectedDate||new Date;newDate.setYear(e.target.value);// console.log(newDate);
_this.setState({selectedDate:newDate,date:newDate});if(_this.props.onChangeYear){_this.props.onChangeYear(newDate)}},_this.getYears=function(){var arrYears=(0,_lodash.range)(_this.props.minDate.getFullYear()-1,_this.props.maxDate.getFullYear()+1);return _this.props.reverseYear?arrYears.reverse():arrYears},_this.renderOptionYear=function(e){return _this.getYears().map(function(year){return _react2.default.createElement('option',{key:year,value:year},year)})},_temp),_possibleConstructorReturn(_this,_ret)}Datepicker.prototype.renderInput=function renderInput(){// console.log(this.props.defaultDate);
var date=this.props.selectedDate||this.props.defaultDate;var value=(0,_format2.default)(date,this.props.dateFormat);if(!this.props.noInput){return _react2.default.createElement('div',{className:'slds-form-element__control slds-input-has-icon slds-input-has-icon_right'},_react2.default.createElement('input',{type:'text',className:'slds-input',id:datepickerId,onFocus:this.props.onCalendarFocus,value:value,onChange:function onChange(){}}),_react2.default.createElement(_ButtonIcon2.default,{type:'button',variant:'utility',icon:'event',className:'slds-input__icon slds-input__icon_right',title:'Select a date',onClick:this.props.onClickDateIcon}))}};Datepicker.prototype.render=function render(){var _props=this.props,id=_props.id,_props$date=_props.date,date=_props$date===undefined?new Date:_props$date,todayText=_props.todayText,label=_props.label,props=_objectWithoutProperties(_props,['id','date','todayText','label']);var currentDate=this.state.date||this.state.selectedDate||props.defaultDate;var monthName=(0,_format2.default)(currentDate,'MMMM');var className=(0,_utils.createClassName)('slds-form-element slds-dropdown-trigger slds-dropdown-trigger_click',props.showCalendar?'slds-is-open':'');return _react2.default.createElement('div',{className:className,onBlur:this.onCalendarBlur},// label
label?_react2.default.createElement('label',{className:'slds-form-element__label',htmlFor:datepickerId},label||'Date'):null,this.renderInput(),_react2.default.createElement('div',{'aria-hidden':'false','aria-label':'Date picker: '+monthName,className:'slds-datepicker slds-dropdown slds-dropdown_left',role:'dialog'},_react2.default.createElement('div',{className:'slds-datepicker__filter slds-grid'},_react2.default.createElement('div',{className:'slds-datepicker__filter_month slds-grid slds-grid_align-spread slds-grow'},_react2.default.createElement('div',{className:'slds-align-middle'},_react2.default.createElement(_ButtonIcon2.default,{type:'button',variant:'utility',icon:'left',className:'slds-button_icon-container',title:'Previous Month',onClick:this.onClickPrevMonth})),_react2.default.createElement('h2',{'aria-atomic':'true','aria-live':'assertive',className:'slds-align-middle',id:'month'},monthName),_react2.default.createElement('div',{className:'slds-align-middle'},_react2.default.createElement(_ButtonIcon2.default,{type:'button',variant:'utility',icon:'right',className:'slds-button_icon-container',title:'Next Month',onClick:this.onClickNextMonth}))),_react2.default.createElement('div',{className:'slds-shrink-none'},_react2.default.createElement('label',{className:'slds-assistive-text',htmlFor:selectId},'Pick a Year'),_react2.default.createElement('div',{className:'slds-select_container'},_react2.default.createElement('select',{className:'slds-select',id:selectId,onChange:this.onChangeYear,value:this.state.selectedDate?this.state.selectedDate.getFullYear():this.props.defaultDate.getFullYear()},this.renderOptionYear())))),_react2.default.createElement(Calendar,{date:currentDate,onClickDay:this.onClickDay,selected:this.state.selectedDate||this.props.selectedDate}),_react2.default.createElement('button',{className:'slds-button slds-align_absolute-center slds-text-link',onClick:this.onClickToday},todayText)))};return Datepicker}(_react.PureComponent);var todayDate=new Date;Datepicker.defaultProps={todayText:'Today',date:new Date,defaultDate:new Date,// date display
dateFormat:'MM/DD/YYYY',selectedDate:null,maxDate:new Date(todayDate.getFullYear()+40,11,31),minDate:new Date(todayDate.getFullYear()-100,0,1),reverseYear:true,noInput:false,showCalendar:true,onClickDateIcon:function onClickDateIcon(){}};Datepicker.propTypes={todayText:_propTypes2.default.string};exports.default=Datepicker;